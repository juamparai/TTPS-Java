<div class="editar-mascota-container">
  <!-- Botones superiores -->
  <div class="top-actions">
    <button type="button" class="btn-volver" (click)="volver()">
      ← Volver
    </button>
    <button type="button" class="btn-eliminar" (click)="abrirModalEliminar()">
      Eliminar
    </button>
  </div>

  @if (loadingMascota()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Cargando datos de la mascota...</p>
    </div>
  } @else {
    <div class="form-card">
      <div class="form-header">
        <h1>Editar Mascota</h1>
        <p class="subtitle">Actualiza la información de tu mascota</p>
      </div>

      @if (error()) {
        <div class="alert alert-error">
          {{ error() }}
        </div>
      }

      <form (ngSubmit)="onSubmit()" #mascotaForm="ngForm">
        <!-- Nombre -->
        <div class="form-group">
          <label for="nombre" class="required">Nombre</label>
          <input
            type="text"
            id="nombre"
            name="nombre"
            [(ngModel)]="mascota.nombre"
            required
            placeholder="Ej: Luna, Max, Simba..."
            class="form-control"
          />
        </div>

        <!-- Tipo -->
        <div class="form-group">
          <label for="tipo" class="required">Tipo</label>
          <select
            id="tipo"
            name="tipo"
            [(ngModel)]="mascota.tipo"
            required
            class="form-control"
          >
            <option value="">Selecciona un tipo</option>
            @for (tipo of tiposOptions; track tipo.value) {
              <option [value]="tipo.value">{{ tipo.label }}</option>
            }
          </select>
        </div>

        <!-- Raza -->
        <div class="form-group">
          <label for="raza">Raza</label>
          <input
            type="text"
            id="raza"
            name="raza"
            [(ngModel)]="mascota.raza"
            placeholder="Ej: Labrador, Siamés, etc."
            class="form-control"
          />
        </div>

        <!-- Color -->
        <div class="form-group">
          <label for="color">Color</label>
          <input
            type="text"
            id="color"
            name="color"
            [(ngModel)]="mascota.color"
            placeholder="Ej: Negro, Blanco, Marrón..."
            class="form-control"
          />
        </div>

        <!-- Tamaño -->
        <div class="form-group">
          <label for="tamanio">Tamaño</label>
          <select
            id="tamanio"
            name="tamanio"
            [(ngModel)]="mascota.tamanio"
            class="form-control"
          >
            <option value="">Selecciona un tamaño</option>
            @for (tamanio of tamaniosOptions; track tamanio.value) {
              <option [value]="tamanio.value">{{ tamanio.label }}</option>
            }
          </select>
        </div>

        <!-- Descripción -->
        <div class="form-group">
          <label for="descripcion">Descripción</label>
          <textarea
            id="descripcion"
            name="descripcion"
            [(ngModel)]="mascota.descripcion"
            rows="4"
            placeholder="Describe las características especiales de tu mascota..."
            class="form-control"
          ></textarea>
        </div>

        <!-- Imagen actual -->
        @if (currentImageUrl()) {
          <div class="foto-preview">
            <p class="preview-label">Imagen actual:</p>
            <img [src]="currentImageUrl()" alt="Imagen actual" class="preview-image" />
          </div>
        }

        <!-- Nueva imagen -->
        <div class="form-group">
          <label for="imagen">Cambiar imagen</label>
          <input
            type="file"
            id="imagen"
            name="imagen"
            accept="image/jpeg,image/png"
            (change)="onImageSelected($event)"
            class="form-control"
          />
          <small class="form-hint">Solo JPG/JPEG o PNG</small>
        </div>

        <!-- Vista previa de nueva imagen -->
        @if (imagePreviewUrl()) {
          <div class="foto-preview">
            <p class="preview-label">Nueva imagen (vista previa):</p>
            <img [src]="imagePreviewUrl()" alt="Vista previa" class="preview-image" />
          </div>
        }

        <!-- Botones de acción -->
        <div class="form-actions">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="cancelar()"
            [disabled]="loading()"
          >
            Cancelar
          </button>
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="loading() || !mascotaForm.form.valid"
          >
            @if (loading()) {
              <span class="spinner-small"></span>
              Guardando...
            } @else {
              Guardar Cambios
            }
          </button>
        </div>
      </form>
    </div>
  }

  <!-- Modal de confirmación de eliminación -->
  @if (showDeleteModal()) {
    <div class="modal-overlay" (click)="cerrarModalEliminar()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <h2 class="modal-title">¿Eliminar mascota?</h2>
        <p class="modal-message">
          Esta acción eliminará permanentemente la mascota y todas sus publicaciones asociadas.
          Esta acción no se puede deshacer.
        </p>
        <div class="modal-actions">
          <button
            type="button"
            class="btn btn-cancel"
            (click)="cerrarModalEliminar()"
            [disabled]="deleting()"
          >
            Cancelar
          </button>
          <button
            type="button"
            class="btn btn-delete"
            (click)="confirmarEliminar()"
            [disabled]="deleting()"
          >
            @if (deleting()) {
              <span class="spinner-small"></span>
              Eliminando...
            } @else {
              Eliminar
            }
          </button>
        </div>
      </div>
    </div>
  }
</div>
